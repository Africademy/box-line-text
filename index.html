<!DOCTYPE html>
<html lang=en>
<head>
<meta charset=utf-8 /> 
<meta name=viewport content="width=device-width, initial-scale=1"/>
<title>Box Box Line</title>
<style>
html,body {
  height:100%;
  width:100%;
  z-index:0;
  overflow:hidden;
}
* {
  position:absolute;
  margin:0;
  padding:0;
}
figure {
  border:2px solid #777;
  border-radius:10px;
}
figcaption {
  z-index:1;
  font:32px Noto Sans CJK JP, arial;
  color:#333;
  padding:0 .5em;
  line-height:64px;
  outline:none;
}
</style>
</head>
<body>
<script>
let mousedown, dragstart

function createCaption(parent) {
  let caption = document.createElement('figcaption')
  
  caption.contentEditable = 'true'
  parent.append(caption)
  caption.focus()
}

function createBox(p1, p2, cls=false) {
  let box = document.createElement('figure')

  let snap = s => Math.round(s / 64) * 64 - 2 + 'px'

  ;[box.style.left, box.style.top] = p1.map((s, i) => snap(Math.min(s, p2[i])))
  ;[box.style.width, box.style.height] = p1.map((s, i) => snap(Math.abs(s - p2[i])))
  if (!box.style.width && !box.style.height) {
    box.style.border = 'none'
    box.style.width = '100%' // Expand to full screen despite zero width parent
  }
  if(cls) box.classList.add(cls)
  
  document.body.append(box)
  createCaption(box)
}

document.body.addEventListener('mousedown', (e) => {
  if (e.target.tagName == 'FIGCAPTION') return false

  mousedown = true
  dragstart = [e.clientX, e.clientY]
})

document.body.addEventListener('mousemove', (e) => {
  document.querySelectorAll('.temp').forEach(e => e.remove())

  if (mousedown) createBox([e.clientX, e.clientY], dragstart, 'temp')
})

document.body.addEventListener('mouseup', (e) => {
  document.querySelectorAll('.temp').forEach(e => e.remove())

  if (!mousedown) return false
  mousedown = false

  createBox(dragstart, [e.clientX, e.clientY])
})

document.addEventListener('keydown', function(e) {
  if (e.ctrlKey && e.key == 'z') {
    document.querySelector('body>:last-child').remove()
    e.preventDefault()
  }
})
</script>
</body>
</html>